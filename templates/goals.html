{% extends 'base.html' %}

{% block body %}


<!-- Add new goal -->
<h1>Add A New Goal</h1>
<div id="goal-new">
    <form method="post" action="add_goal" id="form-goal">
        
        <!-- Goal name -->
        <div>
        
            i want to
            <input type="text" name="goalName" placeholder="watch tv" required id="input-goal-name"> 
        
        </div>

        <!-- Goal type -->
        <div>
        
            for 
            <select name="goalType" id="select-goal-type">
                <option value="at_least">at least</option>
                <option value="at_most">at most</option>
            </select>

            <!-- Goal hours -->
            <input class="goal-duration" id="hours" type="number" name="hours" placeholder="0" required> hours

            <!-- Goal minutes -->
            <input class="goal-duration" type="number" id="minutes" name="minutes" placeholder="0" required> minutes

        </div>


        <!-- Goal timerange -->
        <div>
            from 
            <input type="datetime-local" id="start-date" name="startDate" class="input-goal-date-time-picker" placeholder="May 1 at 12:00 AM" required><br>

            to
            <input type="datetime-local" name="endDate" id="end-date" class="input-goal-date-time-picker" placeholder="May 31 at 11:59 PM" required>
        </div>

        <div id="goal-save-div">
            <button type="button" id="goal-submit" class="btn btn-primary">
                Create
            </button>
        </div>
    </form>
</div>


<!-- Goal Log -->
<h1>Your Goals</h1>

<table class="table table-hover" id="goal-log">
    <thead>
    <tr>
        <th></th>
        <th scope="col">Goal</th>
        <th scope="col">Type</th>
        <th scope="col">Target</th>
        <th scope="col">End Time</th>
        <th scope="col">Progress</th>
        <th scope="col">Time Left</th>
        <th scope="col"></th>
    </tr>
    </thead> 

    <tbody>
    {% for goal in goals %}
        <!-- Goal id -->
        <form class="form-goal-id"><input type="hidden" class="input-goal-id" value="{{ goal.goal_id }}"></form>
        
        <tr class="tr-goal">
            <!-- Goal name -->
            <td data-toggle="modal" data-target="#{{ goal.goal_id }}-modal" class="td-goal-i-want">I want to </td>
            <td class="td-goal-name" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">{{ goal.name }}</td>

            <!-- Goal type -->
            <td class="td-goal-type">for 
                {% if goal.goal_type == "at_least" %}
                    at least

                {% else %}
                    at most

                {% endif %}
            </td>

            <!-- Goal duration target -->
            <td class="td-goal-duration" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {% if goal.duration.days > 0 %}
                    {{ goal.duration.days }}d 
                {% endif %} 
                {% if (goal.duration.seconds // 3600) > 0 %}
                    {{ goal.duration.seconds // 3600 }}h 
                {% endif %} 
                {% if (goal.duration.seconds // 60 % 60) > 0 %}
                    {{ goal.duration.seconds // 60 % 60 }}min
                {% endif %} 

            </td>

            <!-- Goal end -->
            <td class="td-goal-end-time" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                by {{ goal.end_time.strftime('%b %d at %I:%M %p') }}
            </td>

            <!-- Goal total time progress -->
            <td class="td-goal-total-time" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {{ goal.total_time_str() }}
            </td>

            <!-- Goal time left -->
            <td class="td-goal-time-left" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {{ goal.time_left() }}

            </td>

            <!-- Archive -->
            <td class="td-goal-archive">
                <span class="span-goal-archive">
                <button type="button" class="btn btn-link">
                    x
                </button>              
                </span>

            <!-- Edit modal -->
            <div class="modal fade" id="{{ goal.goal_id }}-modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Edit Goal</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                <form class="modal-form">

                <table>

                <!-- Goal name -->
                <tr>
                    <td class="goal-modal">Goal</td>
                    <td class="td-goal-modal-input">
                        <input class="goal-modal-input-name" type="text" value="{{ goal.name }}" name="{{ goal.goal_id }}">
                    </td>
                </tr>

                <!-- Goal type -->
                <tr>
                <td class="goal-modal">Type</td>
                <td class="td-goal-modal-input">
                    <select class="goal-modal-input-type">
                        {% if goal.goal_type == "at_least" %}
                            <option value="at_least" selected>at least</option>
                            <option value="at_most">at most</option>

                        {% else %}
                            <option value="at_least">at least</option>
                            <option value="at_most" selected>at most</option>
                        
                        {% endif %}
                    </select>
                </td>
                </tr>

                <!-- Goal target duration -->
                <tr>
                <td class="goal-modal">Target</td>
                <td class="td-goal-modal-input">
                
                <!-- Days -->
                <input class="goal-modal-input-duration days" type="text" value="{{ goal.duration.days }}" name="days-{{ goal.goal_id }}"> days<br>

                <!-- Hours -->
                <input class="goal-modal-input-duration hours" type="text" value="{{ goal.duration.seconds // 3600 }}" name="hours-{{ goal.goal_id }}"> hours and<br>

                <!-- Minutes -->
                <input class="goal-modal-input-duration minutes" type="text" value="{{ goal.duration.seconds // 60 % 60 }}" name="
                minutes-{{ goal.goal_id }}"> minutes

                </td>
                </tr>

                <!-- Goal start -->
                <tr>
                <td class="goal-modal">Start</td>
                <td class="td-goal-modal-input">
                    <span class="goal-start-time time-text">
                        {{ goal.start_time.strftime('%b %d at %I:%M %p') }}
                    </span>
                    <span class="input-goal-start-time time-input">
                        <input type="datetime-local" class="modal-input-goal-date-time-picker"> 
                    </span>
                </td>
                </tr>
                
                <!-- Goal end -->
                <tr>
                    <td class="goal-modal">End</td>
                    <td class="td-goal-modal-input">
                        <span class="goal-end-time time-text">
                            {{ goal.end_time.strftime('%b %d at %I:%M %p') }}
                        </span>
                        <span class="input-goal-end-time time-input">
                            <input type="datetime-local" name="endDate" class="modal-input-goal-date-time-picker"> 
                        </span>
                    </td>
                </tr>

                <!-- Goal categories -->
                <tr>
                    <td class="goal-modal">Categories</td>
                    <td class="td-goal-modal-input">
                        <select multiple class="goal-modal-input-goal-categories"> 
                            {% for category in categories %}
                                {% if category in goal.category %}
                                    <option selected>{{ category.name }}</option>

                                {% else %}
                                    <option>{{ category.name }}</option>

                                {% endif %}
                            {% endfor %}
                        </select>
                    </td>
                </tr>

                </table>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-link goal-edit-save">Save</button>
                </div>
            </form>

            </div>
            </div>
            </div>
            </div>


            </td>
        </tr>

    




    {% endfor %}
    </tbody>

</table>






{% endblock %}