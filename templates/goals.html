{% extends 'base.html' %}

{% block body %}
<div class="container">

<!-- Add new goal -->
<h1>Add A New Goal</h1>

<form id="form-goal" method="post">
    <table id="goal-new">
        <tr>
            <td id="td-new-goal-name">
                I want to <input type="text" id="input-new-goal-name" placeholder="watch tv" required autofocus>
            </td>
            <td id="td-goal-type">
                for 
                <select required id="select-goal-type">
                    <option value="Type" disabled selected>Type</option>
                    <option value="at_least">at least</option>
                    <option value="at_most">at most</option>
                </select>
            </td>
            <td id="target-duration">
                <input class="goal-duration" id="hours" type="number" placeholder="0" required> hours

                <input class="goal-duration" type="number" id="minutes" placeholder="0" required> min
            </td>
            <td>
                from 
                <input type="datetime-local" id="start-date" name="startDate" class="input-goal-date-time-picker" placeholder="May 1 at 12:00 AM" required>

                to
                <input type="datetime-local" name="endDate" id="end-date" class="input-goal-date-time-picker" placeholder="May 31 at 11:59 PM" required>
            </td>
            <td>
                <i id="goal-submit" class="material-icons">
                    add_circle
                </i>
            </td>
        </tr>
    </table>

<!-- Categories -->
    <h1>Which tags roll up to this goal?</h1>
    <table>
        <tr>
            <td>
                <input id="new-tag" type="text" placeholder="Create a new tag">
                <a href="#add" id="submit-new-tag">Create</a>
                <select multiple id="tag-select">
                    {% for category in categories %}
                    <option value="{{ category.name }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </td>
        </tr>
    </table>
</form>


<!-- Goal Log -->
<h1>Your Goals</h1>

<!-- Goal Headers -->
<table class="goal-log">
    <tr>
        <td class="head td-goal-expand"></td>
        <td class="head td-goal-name">Goal</td>
        <td class="head td-goal-type td-goal-type">Type</td>
        <td class="head td-goal-range">Time Range</td>
        <td class="head td-goal-duration">Target</td>
        <td class="head td-goal-total-time">Spent</td>
        <td class="head td-goal-time-left">Time Left</td>
        <td class="head td-goal-status">Status</td>
        <td class="head td-goal-save"></td>
        <td class="head td-goal-archive"></td>
    </tr>
</table>

{% for goal in goals %}
    <table class="goal-log">
        <tr class="tr-goal">

        <!-- Goal id -->
        <form class="form-goal-id"><input type="hidden" class="input-goal-id" value="{{ goal.goal_id }}"></form>

            <td class="td-goal-expand">
                <i class="material-icons expand-more">expand_more</i>
                <i class="material-icons expand-less">expand_less</i>
            </td>

            <!-- Goal name -->
            <td class="td-goal-name">
                <input type="text" value="{{ goal.name }}" class="td-input-goal-name">
            </td>

            <!-- Goal type -->
            <td class="td-goal-type">
                <select class="select-goal-type">
                    <option selected class="option-goal-type-selected">
                        {% if goal.goal_type == "at_least" %}
                            at least

                        {% else %}
                            at most

                        {% endif %}
                    </option>
                    <option class="option-goal-type-unselected">
                        {% if goal.goal_type == "at_least" %}
                            at most

                        {% else %}
                            at least

                        {% endif %}
                    </option>
                </select>

            </td>

            <!-- Goal time range -->
            <td class="td-goal-range">
                <input hidden value="{{ goal.start_time.strftime('%-m-%d %I:%M %p') }}" class="td-goal-range-start">
                <input hidden value="{{ goal.end_time.strftime('%-m-%d %I:%M %p') }}" class="td-goal-range-end">
                <input name="datetimes" type="text" class="td-input-goal-range">
            </td>

            <!-- Goal duration target -->
            <td class="td-goal-duration">


                {% if goal.duration.days > 0 %}
                    {% set days = (goal.duration.days)|string + "d " %}
                {% else %}
                    {% set days = '' %}
                {% endif %} 

                {% if (goal.duration.seconds // 3600) > 0 %}
                    {% set hours = (goal.duration.seconds // 3600)|string + "h " %}
                {% else %}
                    {% set hours = '' %}
                {% endif %}

                {% if (goal.duration.seconds // 60 % 60) > 0 %}
                    {% set minutes = (goal.duration.seconds // 60 % 60)|string + "min" %}
                {% else %}
                    {% set minutes = '' %}
                {% endif %}

                {% set target = days + hours + minutes %}

                <input type="text" value="{{ target }}" class="td-input-goal-duration">

            </td>

            <!-- Goal total time progress -->
            <td class="td-goal-total-time" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {{ goal.total_time_str("goal_time") }}
            </td>

            <!-- Goal time left -->
            <td class="td-goal-time-left" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {{ goal.time_left() }}

            </td>

            <!-- Goal status -->
            <td class="td-goal-status" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {% if goal.goal_status() == 'Success!' %}
                    <span class="success">{{ goal.goal_status() }}</span>

                {% elif goal.goal_status() == 'FAILED' %}
                    <span class="fail">{{ goal.goal_status() }}</span>

                {% elif goal.goal_status() == 'In progress' %}
                    {{ goal.goal_status() }}

                {% endif %}
            </td>

            <!-- Save -->
            <td class="td-goal-save">
                <span class="span-goal-save">
                    save
                </span>
            </td>

            <!-- Archive -->
            <td class="td-goal-archive">
                <span class="span-goal-archive">
                    x
                </span>
            </td>
        </tr>
</table>

<div class="div-goal-event-log">
<table class="goal-event-log">
    {% for event in events %}
    {% if goal in event.task.category.goal %}
    <tr class="tr-event-task">

        <!-- Event id, task id -->
        <form class="form-event-id">
            <input type="hidden" class="input-event-id" value="{{ event.event_id }}">
            <input type="hidden" class="input-task-id" value="{{ event.task.task_id }}">
        </form>

        <!-- Task name -->
        <td class="td-event-task">
            <input type="text" value="{{ event.task.name }}" class="td-input-event-task">
        </td>
        
        <!-- Category dropdown -->
        <td class="td-event-task-category">
            {{ event.task.category.name }}
        </td>

        <td class="td-event-times">
            {{ event.start_time.strftime('%I:%M %p') }} - {{ event.stop_time.strftime('%I:%M %p') }}
        </td>

        <!-- Duration -->
        <td class="td-event-duration">
            {{ event.duration_str() }}
        </td>

        <!-- Save -->
        <td class="td-event-task-save">
            <span class="span-event-task-save">
                save
            </span>
        </td>

        <!-- Delete -->
        <td class="td-event-task-remove">
            <span class="span-event-task-remove">
                x
            </span>
        </td>

    </form>
    </tr>
    {% endif %}
    {% endfor %}
</table>
</div>


    {% endfor %}
</div>





{% endblock %}