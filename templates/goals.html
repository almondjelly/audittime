{% extends 'base.html' %}

{% block body %}
<div class="container">

<!-- Add new goal -->
<h1>Add A New Goal</h1>

<form id="form-goal" method="post">
    <table id="goal-new">
        <tr>
            <td id="td-new-goal-name">
                I want to <input type="text" id="input-new-goal-name" placeholder="watch tv" required autofocus>
            </td>
            <td id="td-goal-type">
                for 
                <select required id="select-goal-type">
                    <option value="Type" disabled selected>Type</option>
                    <option value="at_least">at least</option>
                    <option value="at_most">at most</option>
                </select>
            </td>
            <td id="target-duration">
                <input class="goal-duration" id="hours" type="number" placeholder="0" required> hours

                <input class="goal-duration" type="number" id="minutes" placeholder="0" required> min
            </td>
            <td>
                from 
                <input type="datetime-local" id="start-date" name="startDate" class="input-goal-date-time-picker" placeholder="May 1 at 12:00 AM" required>

                to
                <input type="datetime-local" name="endDate" id="end-date" class="input-goal-date-time-picker" placeholder="May 31 at 11:59 PM" required>
            </td>
            <td>
                <i id="goal-submit" class="material-icons">
                    add_circle
                </i>
            </td>
        </tr>
    </table>

<!-- Categories -->
    <h1>Which tags roll up to this goal?</h1>
    <table>
        <tr>
            <td>
                <input id="new-tag" type="text" placeholder="Create a new tag">
                <a href="#add" id="submit-new-tag">Create</a>
                <select multiple id="tag-select">
                    {% for category in categories %}
                    <option value="{{ category.name }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </td>
        </tr>
    </table>
</form>


<!-- Goal Log -->
<h1>Your Goals</h1>

<!-- Goal Headers -->
<table class="goal-log">
    <thead>
    <tr>
        <th></th>
        <th scope="col" class="th-goal td-goal-name">Goal</th>
        <th scope="col" class="td-goal-type">Type</th>
        <th scope="col" class="td-goal-duration">Target</th>
        <th scope="col" class="td-goal-end-time">End Time</th>
        <th scope="col" class="td-goal-total-time">Spent</th>
        <th scope="col" class="td-goal-time-left">Time Left</th>
        <th scope="col" class="td-goal-status">Status</th>
        <th scope="col" class="td-goal-save"></th>
        <th scope="col" class="td-goal-archive"></th>
    </tr>
    </thead> 
</table>

{% for goal in goals %}
    <table class="goal-log">
        <tr class="tr-goal">

        <!-- Goal id -->
        <form class="form-goal-id"><input type="hidden" class="input-goal-id" value="{{ goal.goal_id }}"></form>

            <td class="td-show-tasks">
                <i class="material-icons expand-more">expand_more</i>
                <i class="material-icons expand-less">expand_less</i>
            </td>

            <!-- Goal name -->
            <td class="td-goal-name" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">{{ goal.name }}</td>

            <!-- Goal type -->
            <td class="td-goal-type" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">for 
                {% if goal.goal_type == "at_least" %}
                    at least

                {% else %}
                    at most

                {% endif %}
            </td>

            <!-- Goal duration target -->
            <td class="td-goal-duration" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {% if goal.duration.days > 0 %}
                    {{ goal.duration.days }}d 
                {% endif %} 
                {% if (goal.duration.seconds // 3600) > 0 %}
                    {{ goal.duration.seconds // 3600 }}h 
                {% endif %} 
                {% if (goal.duration.seconds // 60 % 60) > 0 %}
                    {{ goal.duration.seconds // 60 % 60 }}min
                {% endif %} 

            </td>

            <!-- Goal end -->
            <td class="td-goal-end-time" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                by {{ goal.end_time.strftime('%b %d at %I:%M %p') }}
            </td>

            <!-- Goal total time progress -->
            <td class="td-goal-total-time" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {{ goal.total_time_str("goal_time") }}
            </td>

            <!-- Goal time left -->
            <td class="td-goal-time-left" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {{ goal.time_left() }}

            </td>

            <!-- Goal status -->
            <td class="td-goal-status" data-toggle="modal" data-target="#{{ goal.goal_id }}-modal">
                {% if goal.goal_status() == 'Success!' %}
                    <span class="success">{{ goal.goal_status() }}</span>

                {% elif goal.goal_status() == 'FAILED' %}
                    <span class="fail">{{ goal.goal_status() }}</span>

                {% elif goal.goal_status() == 'In progress' %}
                    {{ goal.goal_status() }}

                {% endif %}
            </td>

            <!-- Save -->
            <td class="td-goal-save">
                <span class="span-goal-save">
                    save
                </span>
            </td>

            <!-- Archive -->
            <td class="td-goal-archive">
                <span class="span-goal-archive">
                    x
                </span>

            <!-- Edit modal -->
            <div class="modal fade" id="{{ goal.goal_id }}-modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Edit Goal</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                <form class="modal-form">

                <table>

                <!-- Goal name -->
                <tr class="tr-goal-modal-name">
                    <td class="goal-modal">Goal</td>
                    <td class="td-goal-modal-input">
                        <input class="goal-modal-input-name" type="text" value="{{ goal.name }}" name="{{ goal.goal_id }}">
                    </td>
                </tr>

                <!-- Goal type -->
                <tr class="tr-goal-modal-type">
                <td class="goal-modal">Type</td>
                <td class="td-goal-modal-input">
                    <select class="goal-modal-input-type">
                        {% if goal.goal_type == "at_least" %}
                            <option value="at_least" selected>at least</option>
                            <option value="at_most">at most</option>

                        {% else %}
                            <option value="at_least">at least</option>
                            <option value="at_most" selected>at most</option>
                        
                        {% endif %}
                    </select>
                </td>
                </tr>

                <!-- Goal target duration -->
                <tr class="tr-goal-modal-target">
                <td class="goal-modal">Target</td>
                <td class="td-goal-modal-input">
                
                <!-- Days -->
                <input class="goal-modal-input-duration days" type="text" value="{{ goal.duration.days }}" name="days-{{ goal.goal_id }}"> days<br>

                <!-- Hours -->
                <input class="goal-modal-input-duration hours" type="text" value="{{ goal.duration.seconds // 3600 }}" name="hours-{{ goal.goal_id }}"> hours and<br>

                <!-- Minutes -->
                <input class="goal-modal-input-duration minutes" type="text" value="{{ goal.duration.seconds // 60 % 60 }}" name="
                minutes-{{ goal.goal_id }}"> minutes

                </td>
                </tr>

                <!-- Goal start -->
                <tr class="tr-goal-modal-start">
                <td class="goal-modal">Start</td>
                <td class="td-goal-modal-input">
                    <span class="goal-start-time time-text">
                        {{ goal.start_time.strftime('%b %d at %I:%M %p') }}
                    </span>
                    <span class="input-goal-start-time time-input">
                        <input type="datetime-local" class="modal-input-goal-date-time-picker"> 
                    </span>
                </td>
                </tr>
                
                <!-- Goal end -->
                <tr class="tr-goal-modal-end">
                    <td class="goal-modal">End</td>
                    <td class="td-goal-modal-input">
                        <span class="goal-end-time time-text">
                            {{ goal.end_time.strftime('%b %d at %I:%M %p') }}
                        </span>
                        <span class="input-goal-end-time time-input">
                            <input type="datetime-local" name="endDate" class="modal-input-goal-date-time-picker"> 
                        </span>
                    </td>
                </tr>

                <!-- Goal categories -->
                <tr class="tr-goal-modal-categories">
                    <td class="goal-modal">Categories</td>
                    <td class="td-goal-modal-input">
                        <select multiple class="goal-modal-input-goal-categories"> 
                            {% for category in categories %}
                                {% if category in goal.category %}
                                    <option selected>{{ category.name }}</option>

                                {% else %}
                                    <option>{{ category.name }}</option>

                                {% endif %}
                            {% endfor %}
                        </select>
                    </td>
                </tr>

                </table>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-link goal-edit-save">Save</button>
                </div>
            </form>

            </div>
            </div>
            </div>
            </div>


            </td>
        </tr>

    







</table>

<div class="div-goal-event-log">
<table class="goal-event-log">
    {% for event in events %}
    {% if goal in event.task.category.goal %}
    <tr class="tr-event-task">

        <!-- Event id, task id -->
        <form class="form-event-id">
            <input type="hidden" class="input-event-id" value="{{ event.event_id }}">
            <input type="hidden" class="input-task-id" value="{{ event.task.task_id }}">
        </form>

        <!-- Task name -->
        <td class="td-event-task">
            <input type="text" value="{{ event.task.name }}" class="td-input-event-task">
        </td>
        
        <!-- Category dropdown -->
        <td class="td-event-task-category">
            {{ event.task.category.name }}
        </td>

        <td class="td-event-times">
            {{ event.start_time.strftime('%I:%M %p') }} - {{ event.stop_time.strftime('%I:%M %p') }}
        </td>

        <!-- Duration -->
        <td class="td-event-duration">
            {{ event.duration_str() }}
        </td>

        <!-- Save -->
        <td class="td-event-task-save">
            <span class="span-event-task-save">
                save
            </span>
        </td>

        <!-- Delete -->
        <td class="td-event-task-remove">
            <span class="span-event-task-remove">
                x
            </span>
        </td>

    </form>
    </tr>
    {% endif %}
    {% endfor %}
</table>
</div>


    {% endfor %}
</div>





{% endblock %}